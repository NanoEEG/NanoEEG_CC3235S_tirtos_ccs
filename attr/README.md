`@attr/attrTbl`
================
属性层的设计是整个架构的核心，属性层设计的目的是使上位机（plumberhub）通过属性层能够透明地访问NanoEEG设备的硬件。属性层通过属性完成对NanoEEG设备功能的抽象。

## 数据结构

- 属性 Attr_t

<table class="table table-bordered table-striped table-condensed">
	<tr>
	    <th>名称</th>
	    <th>字节数</th>
	    <th>描述</th>  
	</tr>
	<tr>
	    <td rowspan="2">属性权限</td>
	   	<td rowspan="2">1</td>
        <td>只读（Read Only，RO）：属性值只能被读取</td>
	</tr>
	<tr>
	    <td>读写（Read or Write，RW）：属性值可读可写</td>
	</tr>
	<tr>
	    <td rowspan="3">属性类型</td>
	    <td rowspan="3">1</td>
        <td>开关类型：二值属性，表示某种状态的使能/关闭</td>
	</tr>
	<tr>
	    <td>配置类型：表示配置参数</td>
	</tr>
	<tr>
	    <td>消息类型：表示动态更新的数据</td>
	</tr>    
	<tr>
        <td>属性值长度</td>
	    <td>1</td>
	    <td>以字节为单位</td>
	</tr>   
 	<tr>
        <td>属性值地址</td>
	    <td>4</td>
	    <td>属性值所存储的地址</td>
	</tr>      
</table>

NanoEEG在系统外设初始化后需要构建属性表AttrTbl。由于不同的属性值所占字节数不同，本模块采用了分离式的存储方式，即属性只包含属性值所在地址。每个属性结构所占字节数固定，在构建属性表时能够紧凑排列，属性能够根据偏移量访问。

> 属性对上位机访问设备的约束：
> 属性权限约束上位机对属性的读写，即只读属性属性值不允许被上位机修改，读写属性属性值可被上位机修改； 
> 属性类型约束上位机对属性值修改，配置类型的属性值修改需要属性表内部检查上位机修改值是否正确，开关类型的属性值只能是0或者1，上位机修改值由属性表有限状态机维护。

- 属性表 AttrTbl_t

本版本的NanoEEG属性表如下，上位机通过**属性编号**依照`属性协议@ref protocol/readme.md`访问属性，实现对设备的控制和运行状态的获取。
如需要添加功能，请按照`attr_t 数据结构`添加属性至表尾。

|编号|属性名|        描述       |
|:--:|:----:|:-----------------:|
| 0 | 仪器UID |无|
| 1 | 仪器总通道数 |无|
| 2 | 采样开关 |0-停止采样 1-开始采样|
| 3 | 阻抗测量开关 |0-无阻抗测量 1-阻抗测量|
| 4 | 阻抗测量方案 |0- 正弦波测AC电阻 1- 测DC电阻 2- 交流激励测阻抗|
| 5 | 逐通道阻抗值 |无|
| 6 | 仪器网口MAC地址 |无|
| 7 | 仪器当前IP地址 |无|
| 8 | EEG数据通道每包含AD样本数 |无|
| 9 | EEG数据通道端口 |无|
| 10 | 事件标签通道端口 |无|
| 11 | 支持的采样率挡位 |无|
| 12 | 当前全局采样率 |无|
| 13 | 支持的增益挡位 |无|
| 14 | 当前全局增益 |无|
| 15 | 外触发信号延迟时间 | 单位us |

## 接口
- 应用层访问接口 

	应用层对属性值的访问只能通过属性表提供的接口函数，即`App_GetAttr()`和`App_WriteAttr()` 
	当属性表的值被上位机修改后，属性表应通知应用层。本项目采用回调函数的方式以实现解耦，即属性表向应用层提供属性值变化的回调注册函数`AttrTbl_RegisterAppCBs()`。

- 协议层访问接口

	上位机对属性访问包含写属性值和读属性值两种操作， 属性层需要实现读写属性的方法，即`ReadAttrCB()`和`WriteAttrCB()`,并将两个函数指针传递给协议层，即向协议层注册回调函数，
	本项目中把上述两个函数指针封装成结构体`attr_CBs`，通过协议层的注册回调函数向协议层传递该结构体。
